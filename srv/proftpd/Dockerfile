FROM uws/base-testing

LABEL mantainer="Jerem√≠as Casteglione <jeremias@talkingpts.org>"
LABEL version="20210708"

USER root:root
WORKDIR /root

ENV USER root
ENV HOME /root

RUN /root/bin/apt-install.sh proftpd-core proftpd-mod-crypto

COPY ./secret/ssh/ /etc/ssh/
RUN chmod -v 0600 /etc/ssh/ssh_host_*_key \
	&& chmod -v 0640 /etc/ssh/ssh_host_*_key.pub

COPY ./secret/auth/passwd /etc/ftp.passwd
RUN chmod -v 0640 /etc/ftp.passwd

COPY ./secret/auth/group /etc/ftp.group
RUN chmod -v 0640 /etc/ftp.group

COPY ./config/ /etc/proftpd/
COPY ./entrypoint.sh /usr/local/bin/entrypoint.sh

RUN proftpd --configtest

ENTRYPOINT /usr/local/bin/entrypoint.sh
