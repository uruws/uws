---
- name: config
  become: yes
  template:
    src: nginx_tls.conf
    dest: /etc/nginx/conf.d/zzzuws_tls.conf
    mode: '0644'
    owner: root
    group: root
  notify:
    - reload nginx
  tags:
    - nginx
    - nginx_tls

- name: snippets
  become: yes
  template:
    src: nginx_{{ item }}.conf
    dest: /etc/nginx/snippets/uws_{{ item }}.conf
    mode: '0644'
    owner: root
    group: root
  loop:
    - ssl
    - ssl-verify-client
  notify:
    - reload nginx
  tags:
    - nginx
    - nginx_tls

- name: site snippets
  become: yes
  template:
    src: ~/asb/{{ asbenv }}/nginx/{{ item }}.conf
    dest: /etc/nginx/snippets/uws_{{ item }}.conf
    mode: '0644'
    owner: root
    group: root
  loop: "{{ [nginx_default_tls_snippets, nginx_tls_site_snippets] | flatten }}"
  notify:
    - reload nginx
  tags:
    - nginx
    - nginx_tls

- name: default server
  become: yes
  template:
    src: nginx/default_tls.conf
    dest: /etc/nginx/sites-enabled/default_tls
    mode: '0644'
    owner: root
    group: root
  notify:
    - reload nginx
  tags:
    - nginx
    - nginx_tls
