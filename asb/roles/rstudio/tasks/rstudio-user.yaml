---
- name: RStudio user's group
  become: true
  ansible.builtin.group:
    name: rstudio
    state: present
    gid: "{{ rstudio_gid }}"
  tags:
    - users

- name: RStudio user remove
  become: true
  ansible.builtin.user:
    state: absent
    force: false
    remove: true
    name: "{{ item.name }}"
  loop: "{{ rstudio_user_remove | dict2items(key_name='name', value_name='uid') }}"
  tags:
    - users

- name: RStudio user
  become: true
  ansible.builtin.user:
    state: present
    name: "{{ item.name }}"
    uid: "{{ item.uid }}"
    append: false
    comment: "{{ item.name }}"
    create_home: true
    group: rstudio
    home: "{{ uws_users_homedir }}/{{ item.name }}"
    shell: /bin/bash
    expires: "{{ rstudio_user_expire }}"
  loop: "{{ rstudio_user | dict2items(key_name='name', value_name='uid') }}"
  tags:
    - users

- name: RStudio user home dir
  become: true
  ansible.builtin.file:
    state: directory
    path: "{{ uws_users_homedir }}/{{ item.name }}"
    owner: "{{ item.name }}"
    group: rstudio
    mode: '0750'
  loop: "{{ rstudio_user | dict2items(key_name='name', value_name='uid') }}"
  tags:
    - users

- name: RStudio user umask
  become: true
  ansible.builtin.lineinfile:
    path: "{{ uws_users_homedir }}/{{ item }}/.profile"
    backup: true
    state: present
    regexp: '^umask'
    line: 'umask 0002'
  loop: "{{ rstudio_user | list }}"
  tags:
    - users
    - rstudio
