---
- name: Docker install
  become: true
  ansible.builtin.apt:
    install_recommends: false
    pkg:
      - docker.io
      - docker-compose
  tags:
    - apt
    - docker-apt

- name: Docker user group
  become: true
  ansible.builtin.group:
    state: present
    name: docker
    system: true
  tags:
    - docker

- name: Docker group auth
  become: true
  ansible.builtin.user:
    name: "{{ item }}"
    append: true
    groups: docker
  loop: "{{ docker_users }}"
  tags:
    - docker

- name: Docker ecr docker login script
  ansible.builtin.copy:
    src: ~/host/ecr-login.sh
    dest: "~/bin/ecr-login.sh"
    mode: '0750'
  tags:
    - docker

- name: Docker ecr docker login
  ansible.builtin.command: "~/bin/ecr-login.sh {{ aws_region }}"
  tags:
    - docker
