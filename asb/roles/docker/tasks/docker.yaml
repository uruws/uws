---
- name: install
  become: true
  apt:
    install_recommends: false
    pkg:
      - docker.io
      - docker-compose
  tags:
    - apt
    - docker-apt

- name: user group
  become: true
  group:
    state: present
    name: docker
    system: true
  tags:
    - docker

- name: group auth
  become: true
  user:
    name: "{{ item }}"
    append: true
    groups: docker
  loop: "{{ docker_users }}"
  tags:
    - docker

- name: ecr docker login script
  copy:
    src: ~/host/ecr-login.sh
    dest: "~/bin/ecr-login.sh"
    mode: '0750'
  tags:
    - docker

- name: ecr docker login
  command: "~/bin/ecr-login.sh {{ aws_region }}"
  tags:
    - docker
