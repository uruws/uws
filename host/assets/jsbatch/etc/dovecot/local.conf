# https://www.linode.com/docs/guides/email-with-postfix-dovecot-and-mysql/

postmaster_address = jeremias@talkingpts.org

protocols = imap pop3 lmtp

mail_location = maildir:/srv/vmail/%n/maildir
mail_privileged_group = mail

first_valid_uid = 8

disable_plaintext_auth = yes
auth_mechanisms = plain login

# https://doc.dovecot.org/configuration_manual/authentication/passwd_file/

passdb {
  driver = passwd-file
  args = scheme=SSHA256 username_format=%n /etc/dovecot/users
}

userdb {
  driver = static
  args = uid=mail gid=mail home=/srv/vmail/%n
}

service imap-login {
  inet_listener imap {
    # disable
    port = 0
  }
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

service pop3-login {
  inet_listener pop3 {
    # disable
    port = 0
  }
  inet_listener pop3s {
    port = 995
    ssl = yes
  }
}

service submission-login {
  inet_listener submission {
    # disable
    port = 0
  }
}

service auth {
  # Postfix smtp-auth
  #unix_listener /var/spool/postfix/private/auth {
    #mode = 0600
    #user = postfix
    #group = postfix
  #}
  unix_listener auth-userdb {
    mode = 0600
    user = mail
  }
  user = dovecot
}

service auth-worker {
  user = dovecot
}

service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    mode = 0600
    user = postfix
    group = postfix
  }
}

ssl = required
ssl_cert = </srv/acme/cert/ops.uws.talkingpts.org.crt
ssl_key = </srv/acme/key/ops.uws.talkingpts.org.key
