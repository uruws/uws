#!/usr/bin/env python3

# Copyright (c) Jerem√≠as Casteglione <jeremias@talkingpts.org>
# See LICENSE file.

import sys
from argparse import ArgumentParser
from os import system
from subprocess import check_output

import uwscli

def __out_split(out):
	lmax = 0
	lines = {}
	for l in out.splitlines():
		i = l.split(':', 1)
		lines[i[0]] = ':'.join(i[1:])
		llen = len(i[0])
		if llen > lmax:
			lmax = llen
	return (lmax, lines)

def all_help():
	cmd = "grep -sE '^__doc__' %s/*" % uwscli.bindir
	cmd += """ | sed "s/'//g" | sed "s#"""
	cmd += "%s\/" % uwscli.bindir
	cmd += '##" | sed "s/__doc__ = //"'
	out = check_output(cmd, shell = True, text = True)
	lmax, lines = __out_split(out)
	print('uws command line interface')
	print('')
	print('available commands:')
	print('')
	for c in lines.keys():
		print('  ', c, ' '*(lmax - len(c)), ' - ', lines[c], sep = '')
	print('')
	print('run `uwshelp cmd` to get more information about cmd usage')
	return 0

def main():
	flags = ArgumentParser(description = 'show uwscli commands help')
	flags.add_argument('cmd', metavar = 'cmd', default = '', nargs = '?',
		help = 'command')

	args = flags.parse_args()

	if args.cmd == '':
		return all_help()

	return system("%s/%s --help" % (uwscli.bindir, args.cmd))

if __name__ == '__main__':
	sys.stdout.reconfigure(line_buffering = False)
	sys.stderr.reconfigure(line_buffering = False)
	sys.exit(main())
