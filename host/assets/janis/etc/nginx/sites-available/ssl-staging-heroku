#
# staging-heroku SSL internal domain
#

upstream tapostagingapi {
	server janisapi-upstream.uws.talkingpts.org;
}

upstream tapostagingweb {
	server janisweb-upstream.uws.talkingpts.org;
}

server {
	listen 443 ssl;
	listen [::]:443 ssl;

	server_name staging-heroku.uws.talkingpts.org;
	server_tokens off;

	root /var/www/html;

	ssl_certificate /srv/acme/cert/staging-heroku.uws.talkingpts.org.crt;
	ssl_certificate_key /srv/acme/key/staging-heroku.uws.talkingpts.org.key;

	include /srv/etc/nginx/ssl.conf;

	location /api/ {
		include /etc/nginx/proxy_params;
		proxy_set_header Host janisapi-upstream.uws.talkingpts.org;
		proxy_ssl_name janisapi-upstream.uws.talkingpts.org;
		proxy_pass https://tapostagingapi;
	}

	location / {
		include /etc/nginx/proxy_params;
		proxy_set_header Host janisweb-upstream.uws.talkingpts.org;
		proxy_ssl_name janisweb-upstream.uws.talkingpts.org;
		proxy_pass https://tapostagingweb;
	}
}
