#!/bin/sh
set -eu

mkdir -vp /srv/cache/nginx/uws
chown -v www-data:www-data /srv/cache/nginx/uws
chmod -v 0750 /srv/cache/nginx/uws

chown -v www-data:www-data /srv/cache/nginx
chmod -v 0750 /srv/cache/nginx

mkdir -vp /srv/www/public
chown -v uws:www-data /srv/www/public
chmod -v 0750 /srv/www/public

chown -v uws:www-data /srv/www
chmod -v 0750 /srv/www

chmod -v 0644 /var/www/html/index.html

if test -s /srv/acme/cert/uws.talkingpts.org.crt; then
	install -v /etc/nginx/sites-available/ssl-default /etc/nginx/sites-enabled
else
	rm -vf /etc/nginx/sites-enabled/ssl-default
fi
if test -s /srv/acme/cert/janis.uws.talkingpts.org.crt; then
	install -v /etc/nginx/sites-available/ssl-janis /etc/nginx/sites-enabled
else
	rm -vf /etc/nginx/sites-enabled/ssl-janis
fi

exit 0
