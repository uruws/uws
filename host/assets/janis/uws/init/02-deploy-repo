#!/bin/sh
set -eu

REPO=/srv/uws/deploy.git
WDIR=/srv/uws/deploy

umask 0027
uws='sudo -n -u uws'

if ! test -d ${REPO}; then
	${uws} git init --bare ${REPO}
fi

chown -v root:uws /uws/git-uws*.sh
chmod -v 0750 /uws/git-uws*.sh

install -o root -g uws -m 0750 /uws/git-uws-update.sh ${REPO}/hooks/update

if ! test -d ${WDIR}; then
	${uws} git clone ${REPO} ${WDIR}
fi

exit 0
