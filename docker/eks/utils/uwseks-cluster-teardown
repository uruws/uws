#!/bin/sh
set -eu

cluster=${1:?'cluster name?'}
files=/home/uws/files
kubectl="kubectl --kubeconfig=/home/uws/.kube/eksctl/clusters/${cluster}"

# cluster autoscaler
# https://docs.aws.amazon.com/eks/latest/userguide/cluster-autoscaler.html

sed "s#\[UWSEKS_CLUSTER]#${cluster}#" ${files}/cluster-autoscaler.yaml >/tmp/cluster-autoscaler-${cluster}.yaml

${kubectl} delete -f /tmp/cluster-autoscaler-${cluster}.yaml

#~ eksctl delete iamserviceaccount \
	#~ --cluster=${cluster} \
	#~ --namespace=kube-system \
	#~ --name=cluster-autoscaler \
	#~ --approve

# aws auth

#~ ${kubectl} delete -f ${files}/aws-auth.yaml

exit 0
